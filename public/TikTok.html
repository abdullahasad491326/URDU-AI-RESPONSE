<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pro TikTok Downloader</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{ --glass: rgba(255,255,255,0.08); }
    body{ font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .glass{ background: var(--glass); backdrop-filter: blur(12px); }
    .shine{ position: relative; overflow: hidden; }
    .shine:before{ 
      content:''; 
      position:absolute; 
      inset:-200% -50%; 
      background:radial-gradient(50% 50% at 50% 50%, rgba(255,255,255,.15) 0%, rgba(255,255,255,0) 60%); 
      animation: spin 12s linear infinite; 
      pointer-events: none;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-800 text-slate-100">
  <div class="max-w-2xl mx-auto px-4 py-10">

    <!-- Header -->
    <header class="mb-8 text-center">
      <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight">
        <span class="bg-clip-text text-transparent bg-gradient-to-r from-indigo-300 via-fuchsia-300 to-pink-300">Pro TikTok Downloader</span>
      </h1>
      <p class="mt-3 text-slate-300">Fast ‚Ä¢ Clean ‚Ä¢ MP4 / HD / MP3 ‚Ä¢ No device fingerprint leak</p>
    </header>

    <!-- Input Section -->
    <section class="glass shine rounded-3xl p-5 md:p-7 shadow-2xl border border-white/10">
      <div class="flex flex-col md:flex-row gap-3">
        <input 
          id="url" 
          type="text" 
          placeholder="Paste TikTok URL (e.g. https://vm.tiktok.com/...)" 
          class="flex-1 rounded-2xl bg-black/30 border border-white/10 px-4 py-3 outline-none focus:ring-2 ring-indigo-400" 
          autocomplete="off"
        />
        <button id="go" class="rounded-2xl px-6 py-3 bg-indigo-500 hover:bg-indigo-600 active:bg-indigo-700 transition font-semibold">Fetch</button>
      </div>
      <p id="hint" class="mt-2 text-xs text-slate-400">We proxy via our backend with spoofed headers. Your real device info stays private.</p>
    </section>

    <!-- Result Section -->
    <section id="result" class="mt-8 hidden">
      <div class="glass rounded-3xl p-4 border border-white/10">
        <h3 class="text-lg font-semibold mb-4">Download Options</h3>

        <!-- Loader -->
        <div id="loading" class="text-slate-300">‚è≥ Fetching download links...</div>

        <!-- Buttons (hidden until response) -->
        <div id="buttons" class="flex flex-col gap-3 hidden">
          <a id="mp4" href="#" class="block w-full text-center px-4 py-3 rounded-lg bg-indigo-500 hover:bg-indigo-600 font-semibold">üé• Download MP4 [1]</a>
          <a id="mp4hd" href="#" class="block w-full text-center px-4 py-3 rounded-lg bg-emerald-500 hover:bg-emerald-600 font-semibold">üì∫ Download MP4 HD</a>
          <a id="mp3" href="#" class="block w-full text-center px-4 py-3 rounded-lg bg-pink-500 hover:bg-pink-600 font-semibold">üé∂ Download MP3</a>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="mt-10 text-center text-xs text-slate-400">
      Built with ‚ù§Ô∏è ‚Äî headers spoofed/rotated on the server to avoid device misuse.
    </footer>
  </div>

  <!-- Floating WhatsApp Channel Button -->
  <div style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
    <a href="https://whatsapp.com/channel/0029Vb9shWp4o7qPSrCXS603" target="_blank" 
       style="background: #25D366; color: white; padding: 12px 20px; border-radius: 30px; 
              font-size: 16px; font-weight: bold; text-decoration: none; 
              box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: 0.3s;">
      üì¢ Join Channel
    </a>
  </div>

  <!-- Script -->
  <script>
    const el = (sel) => document.querySelector(sel);
    const resWrap = el('#result');
    const buttons = el('#buttons');
    const loader = el('#loading');
    const urlInput = el('#url');

    async function fetchLinks() {
      const url = urlInput.value.trim();
      if (!url) { alert('Please paste a TikTok URL'); return; }

      resWrap.classList.remove('hidden');
      loader.classList.remove('hidden');
      buttons.classList.add('hidden');

      try {
        const resp = await fetch('/api/tiktok', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url })
        });
        const data = await resp.json();
        if (!data.success) throw new Error('Failed to fetch TikTok data');

        // Hide loader, show buttons
        loader.classList.add('hidden');
        buttons.classList.remove('hidden');

        // Assign direct links
        el('#mp4').href   = data.downloads.find(d=>d.type.includes('MP4 [1]'))?.link || '#';
        el('#mp4hd').href = data.downloads.find(d=>d.type.includes('MP4 HD'))?.link || '#';
        el('#mp3').href   = data.downloads.find(d=>d.type.includes('MP3'))?.link || '#';

      } catch (e) {
        loader.textContent = "‚ùå Error: " + (e.message || e);
      }
    }

    el('#go').addEventListener('click', fetchLinks);
    urlInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ fetchLinks(); }});
  </script>
</body>
</html>
